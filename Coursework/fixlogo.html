
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Ashley's Project</title>

    <!-- Bootstrap -->
    <link href="material/css/bootstrap.css" rel="stylesheet">
    <link href="material/css/bootstrap-theme.min.css" rel="stylesheet">

    <nav class="navbar navbar-default">
        <div class="container">

            <div class="navbar-header">

                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>

                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a class="navbar-brand" href="#">My Project</a>

            </div>

            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="">Page 1</a></li>
                    <li><a href="">Page 2</a></li>
                </ul>
                <form class="navbar-form navbar-right" action="" method="post">
                    <div class="form-group">
                        <input type="text" placeholder="Username" class="form-control" name="username">
                    </div>
                    <div class="form-group">
                        <input type="password" placeholder="Password" class="form-control" name="password">
                    </div>
                    <button type="button" class="btn btn-default"> <span class="glyphicon glyphicon-log-in"></span> Login </button>
                    <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-user"></span> Sign Up </button>
                    <button type="button" class="btn btn-default"> <span class="glyphicon glyphicon-log-out"></span><a href="logout.php">Log Out</a></button>

                </form>

            </div>

        </div>
        </div>
    </nav>
</head>

<body>




                <div class="container">
                    <div class="jumbotron">
                    <div class="row">
                        <div class="col-md-6">
                            <h1> Viusal upload</h1><br>
                            <img src="material/images/logo.PNG" class="img-rounded "width="304" height="236"/>
                        </div>
                        <div class="col-md-6">
                            <form method="post" action="<?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?>" autocomplete="off">
                                <center><h2>Login</h2></center>
                                <hr/>
                                <?php
            if(isset($errorMsg)){
                ?>
                                <div class="alert alert-danger">
                                    <span class="glyphicon glyphicon-info-sign"></span>
                                    <?php echo $errorMsg; ?>
                                </div>
                                <?php
            }
            ?>
                                <div class="form-group">
                                    <label for="email" class="control-label">Email</label>
                                    <input type="email" name="email" class="form-control" autocomplete="off">
                                    <span class="text-danger"><?php if(isset($errorEmail)) echo $errorEmail; ?></span>
                                </div>
                                <div class="form-group">
                                    <label for="password" class="control-label">Password</label>
                                    <input type="password" name="password" class="form-control" autocomplete="off">
                                    <span class="text-danger"><?php if(isset($errorPassword)) echo $errorPassword; ?></span>
                                </div>
                                <div class="form-group">
                                    <center><input type="submit" name="btn-login" value="Login" class="btn btn-warning"></center>
                                </div>
                                <hr/>
                                <a href="register.php">Register</a>
                            </form>
                        </div>
                </div>
            </div>


                    <form class="navbar-form navbar-right" action="logout.php" method="post">
                        Welcome :<?php echo $_SESSION['username']; ?>
                        <button type="button" class="btn btn-default"> <span class="glyphicon glyphicon-log-out"></span><a href="logout.php">Log Out</a></button>
                    </form>
                    <a href="logout.php" class="btn btn-default" role="button"><span class="glyphicon glyphicon-log-out"></span> Log Out </a>
                    <a class="btn btn-lg btn-default" href="logout.php" ><span class="glyphicon glyphicon-log-out"></span> Log Out </a>


                    <hr>
                    <footer class="footer">
                        <p>&copy; 2017 Ashley Noble</p>
                    </footer>
            </div>

                <?php
                                    $sql = "select * from tbl_images";
                                    $result = mysqli_query($link, $sql);
                                    if(mysqli_num_rows($result)){
                                    while($row = mysqli_fetch_assoc($result)) {

                                    ?>
<!-- index page code for upload-->

                <?php
                include ('dbConnect.php')
                $upload_dir = 'uploads/';
this is for index or uploadimages


this is for add page

                if(isset($_POST['btnSave'])){
                $name = $_POST['name'];
                  $position = $_POST['position'];

                  $imgName = $_Files['myfile']['name'];
                  $imgTmp = $_Files['myfile']['tmp_name'];
                  $imgSize = $_Files['myfile']['size'];

                  if(empty($name)){
                    $errorMsg = 'Please enter a name';
                  }elseif(empty($position)){
                    $errorMsg = 'Please enter position';
                  }elseif(empty($imgName)){
                     $errorMsg = 'Please select image';
                }else{
                    // get image extension
                    $imgExt = pathinfo($imgName, PATHINFO_EXTENSION));
                    // allow extension
                    $alloExt = array('jpeg', 'jpg', 'png', 'gif');
                    //random new name for image
                    $userPic = time().'_'.rand(1000,9999).'.'$imgExt;
                    //check its a valid image
                    if(in_array($imgExt, $allowExt)){
                    //check image size is less than certain amount in this case 5MB
                    if($imgSize < 5000000){
                        move_uploaded_file($imgTmp,$upload_dir.$userPic);
                 }else{
                    $errorMsg = 'The image is too large';
                 }else{
                    $errorMsg = 'Please select a valid image';

                    }
                }
                // check upload file error then can upload image to database
               if(!isset($errorMsg)){
                    $sql = 'insert into tbl_users(name, position, photo)
                            values('".$name."', '".$position."', '".$userPic."')";
                     $result = mysqli_query($link, $sql);
                     if($result){
                        $successMsg = ' New image data has been successfully added';
                        header('refresh;5;uploadimages.php') // in demo has index.php
               ]else[
                    $errorMsg = 'Error '.mysqli_error($link);
                  }

             }

        }

          ?>
                end of add page php//

                <div class="container">
                <div class="page-header">
                    <h3> Add New Image
                      <a class="btn btn-default" href="add.php"><span class="glyphicon glyphicon-plus"></span>&nbsp;Add new
                    </a>
                    </h3>

                    <table class=" table table-bordered table-responsive">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Photo</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?php
                            $sql = "select * from tbl_users";
                            $result = mysqli_query($link, $sql);
                            if(mysqli_num_rows($result)){
                               while($row = mysqli_fetch_assoc(result)){

                        ?>
                        <tr>
                            <th><?php echo $row['id'] ?></th>
                            <th><?php echo $row['name'] ?></th>
                            <th><?php echo $row['position'] ?></th>
                            <th><img src="<?php echo $upload_dir.$row['photo'] ?>" height="40"> </th>
                            <th>
                                <a class="btn btn-default" href="edit.php?id=<?php echo $row['id'] ?>">
                                    <span class="glyphicon glyphicon-edit"></span> Edit</a>
                                <a class="btn btn-default" href=""><span class="glyphicon glyphicon-remove-circle"></span> Delete</a>
                            </th>

                        </tr>

                        <?php
                                }

                            }
                        ?>
                        </tbody>
                    </table>
                </div>
                </div>
                <!--  end index page code for upload-->

                <!-- add page code for upload-->

                <div class="container">
                    <div class="page-header">
                        <h3> Add New Image
                            <a class="btn btn-default" href="uploadimages.php">
                                <span class="glyphicon glyphicon-arrow-left"></span>&nbsp;Back
                            </a>
                        </h3>
                    </div>

                    <?php
                    if(isset($errorMsg)){
                        ?>
                    <div class="alert alert-danger">
                        <span class="glyphicon glyphicon-info-sign"></span>
                        <?php echo $errorMsg; ?>
                    </div>
                    <?php
                    }
                    ?>

                    <?php
                    if(isset($successMsg)){
                        ?>
                    <div class="alert alert-success">
                        <span class="glyphicon glyphicon-info-sign"></span>
                        <?php echo $successMsg; ?> redirecting
                    </div>
                    <?php
                    }
                    ?>

                    <form action="" method="post" enctype="multipart/form-data" class="form-horizontal">
                        <div class="form-group">
                            <label for="name" class="col-md-2">Name </label>
                            <div class="col-md-10">
                                <input type="text" name="name" class="form-control">
                            </div>
                        </div>
                            <div class="form-group">
                                <label for="position" class="col-md-2">Position </label>
                                <div class="col-md-10">
                                    <input type="text" name="position" class="form-control">
                                </div>
                            </div>
                        <div class="form-group">
                            <label for="photo" class="col-md-2">Photo</label>
                            <div class="col-md-10">

                                <input type="file" name="myfile">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="photo" class="col-md-2"></label>
                            <div class="col-md-10">
                                <button type="submit" class="btn btn-success" name="btnSave">
                                    <span class="glyphicon glyphicon-save"></span>Save
                                </button>
                    </form>
                </div>








                edit.php page below
                <?php
                include ('dbConnect.php')
                $upload_dir = 'uploads/';
this is for index or uploadimages
                if (isset($GET['id])){
                    $id = $GET['id'];
                    $sql = "select * from tbl_users where id=" .$id;
                    $result = mysqli_query($link, $sql);
                    if(mysqli_num_rows($result) > 0){
                    $row =mysqli_fetch_assoc($result);
                }else{
                    $errorMsg = 'Could  not select a record';
                    }
                }

this is for add page

                if(isset($_POST['btnUpdate'])){
                $name = $_POST['name'];
                  $position = $_POST['position'];

                  $imgName = $_Files['myfile']['name'];  // extracts information about the file name
                  $imgTmp = $_Files['myfile']['tmp_name']; // extracts information about the file for temporary location
                  $imgSize = $_Files['myfile']['size']; // extracts information about the file size

                  if(empty($name)){
                    $errorMsg = 'Please enter a name';
                  }elseif(empty($position)){
                    $errorMsg = 'Please enter position';
                  }
               // update image if user select new image
                if($imgName){
                    // get image extension
                    $imgExt = pathinfo($imgName, PATHINFO_EXTENSION));
                    // file extensions you allow
                    $allowExt = array('jpeg', 'jpg', 'png', 'gif');
                    //random new name for image
                    $userPic = time().'_'.rand(1000,9999).'.'$imgExt;
                    //check its a valid image
                    if(in_array($imgExt, $allowExt)){
                    //check image size is less than certain amount in this case 5MB
                    if($imgSize < 5000000){
                //delete old image
                unlink($upload_dir.$row['photo']);
                        move_uploaded_file($imgTmp,$upload_dir.$userPic);
                 }else{
                    $errorMsg = 'The image is too large';
                 }else{
                    $errorMsg = 'Please select a valid image';

                    }
                }else{
                    //if not selected new image use old image name
                    $userPic = $row['photo'];
                }
                // check upload file error then can upload image to database
               if(!isset($errorMsg)){
                    $sql = 'insert into tbl_users(name, position, photo)
                            values('".$name."', '".$position."', '".$userPic."')"; // for edit update section remove this and add $sql = "update tbl_users set name = '".$name."',
                                                                                                                                       position = '".$position."',
                                                                                                                                       photo ='".$userPic."'
                                                                                                                                        where id=".$id;
                     $result = mysqli_query($link, $sql);
                     if($result){
                        $successMsg = ' New image data has been successfully added'; change to updated for edit page
                        header('refresh;5;uploadimages.php') // in demo has index.php
               ]else[
                    $errorMsg = 'Error '.mysqli_error($link);
                  }

             }

        }

          ?>
                <div class="container">
                    <div class="page-header">
                        <h3> Add New Image
                            <a class="btn btn-default" href="uploadimages.php">
                                <span class="glyphicon glyphicon-arrow-left"></span>&nbsp;Back
                            </a>
                        </h3>
                    </div>

                    <?php
                    if(isset($errorMsg)){
                        ?>
                    <div class="alert alert-danger">
                        <span class="glyphicon glyphicon-info-sign"></span>
                        <?php echo $errorMsg; ?>
                    </div>
                    <?php
                    }
                    ?>

                    <?php
                    if(isset($successMsg)){
                        ?>
                    <div class="alert alert-success">
                        <span class="glyphicon glyphicon-info-sign"></span>
                        <?php echo $successMsg; ?> redirecting
                    </div>
                    <?php
                    }
                    ?>

                    <form action="" method="post" enctype="multipart/form-data" class="form-horizontal">
                        <div class="form-group">
                            <label for="name" class="col-md-2">Name </label>
                            <div class="col-md-10">
                                <input type="text" name="name" class="form-control" value=">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="position" class="col-md-2">Position </label>
                            <div class="col-md-10">
                                <input type="text" name="position" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="photo" class="col-md-2">Photo</label>
                            <div class="col-md-10">
                                <img src="" width="200">
                                <input type="file" name="myfile">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="photo" class="col-md-2"></label>
                            <div class="col-md-10">
                                <button type="submit" class="btn btn-success" name="btnUpdate">
                                    <span class="glyphicon glyphicon-save"></span>Upload Image
                                </button>
                    </form>
                </div>

            <script src="material/js/bootstrap.min.js"></script>


</body>
</html>